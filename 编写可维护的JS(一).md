# 编写可维护的JS

《编写可维护的JS》的读书笔记，会结合我自己的工作经验，谈一谈如何写出易于维护的JS。作者写这本书的时候（大概2012-2013年）ES6还没出来，考虑到当前MV*时代下，大家几乎都在写ES6，所以本文会针对ES6作特别说明（原书内容针对ES5）。原书作者结合自己的工作经验（2006年开始在雅虎为期5年的工作）写出了这本书，作者在书中浓墨重彩强调的东西，我们现在看来都稀疏平常（如：为什么需要禁用with和eval，为什么始终使用===和!==进行比较），在这些内容上我会一笔带过，假定你已经熟知这些基本常识了。

我们知道JS语言有着先天的设计缺陷（ES6之后才好转了不少），如何不刻意学习如何编写优质易维护的代码，你很容易就写出糟糕的代码（虽然它可以运行）。

关于代码的维护，你需要明白以下四点：

软件生命周期中80%的成本消耗在了维护上。
几乎所有的软件维护者都不是它的最初作者。
编码规范提高了软件的可读性，它让工程师能够快速且充分地理解新的代码。
如果你将源码作为产品来发布，你需要确保它是可完整打包的，且像你创建的其他产品一样整洁。
对的，你写的代码很大概率上，并不是由你来维护的。因为你可能换公司了，可能去做新项目了，也可能你压根就不记得这段代码是你六个月前写的。所以，不要抱着“我就是来搬砖的，随便写写，改不动了就溜了”的态度来写代码，相信读者你也维护过别人写的代码，吐槽过那难以理解没有任何注释的代码，恨不得把写那代码的人拉过来打一顿。所以，请不要成为你所讨厌的人。编写出可维护的代码，既是职业素养的问题，也是你专业精神的体现。

关于如何编写可维护的JS，我将从 编程风格 、编程实践 和 工程化 三个方面进行阐述。

1. 编程风格
程序是写给人读的，只是偶尔让计算机执行一下。 —— Donald Knuth

我们会经常碰到这两个术语：“编程风格”(style guideline)和“编码规范”(code convention)。编程风格是编码规范的一种，用来规约单文件中代码的规划。编码规范还包括编程最佳实践、文件和目录的规划以及注释等方面。本文集中讨论JS的编码规范。

为什么要讨论编程风格？每个人都有自己偏爱的编程风格，但更多的时候我们是作为团队一员进行协作开发的，统一风格十分重要，因为它会促成团队成员高水准的协作（所有的代码看起来极为类似）。毫无疑问，全球性的大公司都对外或者对内发布过编程风格文档，如：Airbnb JavaScript Style Guide, Google JavaScript Style Guide等，你若仔细阅读会发现它们很多规范都是相同的，只是部分细节略有差异。

在某些场景中，很难说哪种编程风格好，哪种编程风格不好，因为有些编程风格只是某些人的偏好。本文并不是向你灌输我个人的风格偏好，而是提炼出了编程风格应当遵循的重要的通用规则。

## 1.1 格式化
关于缩进层次: 我不想挑起“Tab or Space”和“2 or 4 or 6 or 8 Space”的辩论，对这个话题是可以争论上好几个小时的，缩进甚至关系到程序员的价值观。你只要记住以下三点：

代码一定要缩进，保持对其。
不要在同一个项目中混用Tab和Space。
保持与团队风格的统一。
关于结尾分号: 有赖于分析器的自动分号插入（Automatic Semicolon Insertion, ASI）机制，JS代码省略分号也是可以正常工作的。ASI会自动寻找代码中应当使用分号但实际没有分号的位置，并插入分号。大多数场景下ASI都会正确插入分号，不会产生错误，但ASI的分号插入规则非常复杂且很难记住，因此我推荐不要省略分号。大部分的风格指南（除了JavaScript Standard Style）都推荐不要省略分号。

关于行的长度: 大部分的语言以及JS编码风格指南都指定一行的长度为80个字符，这个数值来源于很久之前文本编辑器的单行最多字符限制，即编辑器中单行最多只能显示80个字符，超过80个字符的行要么折行，要么被隐藏起来，这些都是我们所不希望的。我也倾向于将行长度限定在80个字符。

关于换行：当一行长度达到了单行最大字符限制时，就需要手动将一行拆成两行。通常我们会在运算符后换行，下一行会增加两个层次的缩进（我个人认为一个缩进也可以，但绝对不能没有缩进）。例如：

callFunc(document, element, window, 'test', 100,
  true);
在这个例子中，逗号是一个运算符，应当作为前一行的行尾。这个换行位置非常重要，因为ASI机制会在某些场景下在行结束的位置插入分号。总是将一个运算符置于行尾，ASI就不会自作主张地插入分号，也就避免了错误的发生。这个规则有一个例外：当给变量赋值时，第二行的位置应当和赋值运算符的位置保持对齐。比如：

```
var result = something + anotherThing + yetAnotherThing + somethingElse +
             anotherSomethingElse;
```

这段代码里，变量 anotherSomethingElse 和行首的 something 保持左对齐，确保代码的可读性，并能一眼看清楚折行文本的上下文。

关于空行：在编程规范中，空行是常常被忽略的一个方面。通常来讲，代码看起来应当像一系列可读的段落，而不是一大段揉在一起的连续文本。有时一段代码的语义和另一段代码不相关，这时就应该使用空行将它们分隔，确保语义有关联的代码展现在一起。一般来讲，建议下面这些场景中添加空行：

在方法之间。
在方法中的局部变量和第一条语句之间。
在多行或单行注释之前。
在方法内的逻辑片段之间插入空行，提高可读性。

#### date 2018.5.27
